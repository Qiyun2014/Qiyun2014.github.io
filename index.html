<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta property="og:type" content="website">
<meta property="og:title" content="祁云的博客">
<meta property="og:url" content="https://github.com/Qiyun2014/index.html">
<meta property="og:site_name" content="祁云的博客">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="祁云的博客">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"always","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://github.com/Qiyun2014/">





  <title>祁云的博客</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">祁云的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-schedule">
          <a href="/schedule/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-calendar"></i> <br>
            
            Schedule
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://github.com/Qiyun2014/2019/05/09/iOS内购支持/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Qiyun">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="祁云的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/05/09/iOS内购支持/" itemprop="url">iOS内购支持</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-05-09T09:38:48+08:00">
                2019-05-09
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/05/09/iOS内购支持/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2019/05/09/iOS内购支持/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="iOS内购支持"><a href="#iOS内购支持" class="headerlink" title="iOS内购支持"></a>iOS内购支持</h1><h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>内购是apple官方唯一提供用户消费的手段，同时用户消费金额，apple会提取30%做为手续费用。<br>在App内购买非实物产品（如游戏币，电子书，视频等虚拟产品）需要走内购流程。</p>
<p>开发者需要注意苹果支持90日内退款申请,如果你的商品如:付费视频。用户在购买完成的一个月内看完后,申请退款!那么你的商品就属于“高级的免费商品”。</p>
<h2 id="内购流程设计"><a href="#内购流程设计" class="headerlink" title="内购流程设计"></a>内购流程设计</h2><p><img src="https://ws1.sinaimg.cn/large/006tNc79gy1g2uu96iwmkj30f7050mx0.jpg" alt></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Application：商品展示及购买服务对接；</span><br><span class="line">AppStore：提供商品及购买情况；</span><br><span class="line">Server：存储订单和验证订单状态；</span><br></pre></td></tr></table></figure>
<p><img src="https://ws4.sinaimg.cn/large/006tNc79gy1g2uuc7n8odj30ft083jrk.jpg" alt></p>
<ul>
<li>1、app开发者从服务器获取商品列表；</li>
<li>2、根据商品id从appstore查找可用的商品；</li>
<li>3、显示商品信息，由用户选择指定商品购买；</li>
<li>4、用户购买并付款后，存储付款凭证和商品信息并告诉服务器；</li>
<li>5、服务器根据凭证向apple服务器查询付款状态；</li>
<li>6、交易成功或者失败；</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://github.com/Qiyun2014/2019/05/06/私有pod仓库创建/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Qiyun">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="祁云的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/05/06/私有pod仓库创建/" itemprop="url">私有pod仓库创建</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-05-06T15:08:48+08:00">
                2019-05-06
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/05/06/私有pod仓库创建/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2019/05/06/私有pod仓库创建/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="私有pod仓库创建"><a href="#私有pod仓库创建" class="headerlink" title="私有pod仓库创建"></a>私有pod仓库创建</h1><h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>为什么需要集成Cocoapods，生成私有pod？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">当我们某一块功能可以在多个模块使用，进行pod管理，有利于在项目开发中维护。</span><br><span class="line"></span><br><span class="line">同时，与业务功能解耦。</span><br></pre></td></tr></table></figure>
<h2 id="搭建pod项目"><a href="#搭建pod项目" class="headerlink" title="搭建pod项目"></a>搭建pod项目</h2><ul>
<li><ol>
<li>创建自己的仓库地址，gitlab或者github</li>
</ol>
</li>
<li><ol start="2">
<li>clone到本地，添加项目文件</li>
</ol>
</li>
<li><ol start="3">
<li>配置podspec文件信息</li>
</ol>
</li>
<li><ol start="4">
<li>push到远端git仓库，并推送tag信息</li>
</ol>
</li>
<li><ol start="5">
<li>pod本地验证</li>
</ol>
</li>
<li><ol start="6">
<li>同步到cocoapods远端服务器</li>
</ol>
</li>
</ul>
<h2 id="命令介绍"><a href="#命令介绍" class="headerlink" title="命令介绍"></a>命令介绍</h2><p>添加repo到仓库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pod repo add REPO_NAME SOURCE_URL</span><br></pre></td></tr></table></figure>
<p>创建pod模板工程，用于本地测试</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pod lib create MyLibrary</span><br></pre></td></tr></table></figure>
<p>提交工程代码信息及tag到远端git仓库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git add .</span><br><span class="line">git commit -a -m &quot;update tag&quot;</span><br><span class="line">git tag -m &quot;tag version update&quot; &quot;1.0.1&quot;</span><br><span class="line">git push --tags</span><br></pre></td></tr></table></figure>
<p>注册个人信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pod trunk register qiyun@yryz.com --description=&apos;自定义相册库&apos;</span><br><span class="line">pod trunk me</span><br><span class="line">pod trunk push</span><br></pre></td></tr></table></figure>
<p>验证私有pod合法性并repo进行同步</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pod lib lint --verbose --allow-warnings</span><br><span class="line">pod repo push xxx xxx.podspec —allow-warnings —verbose</span><br></pre></td></tr></table></figure>
<h2 id="pod工程介绍"><a href="#pod工程介绍" class="headerlink" title="pod工程介绍"></a>pod工程介绍</h2><p><img src="https://ws2.sinaimg.cn/large/006tNc79gy1g2u24rhch6j310y0jk40r.jpg" alt></p>
<pre><code>1    You can edit your Podspec metadata, this lets you change your README and Podspec.
2    This is the Demo Library, you will be missing this if you didn&apos;t say yes to it.
3    Here is a stubbed out test spec for the framework you had chosen earlier.
4    This is the Development Pods section, and actually where you can work on your library. See below for more information.
5    Finally the Pods used in setting up the project.
</code></pre><h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><p><a href="http://guides.cocoapods.org/making/using-pod-lib-create" target="_blank" rel="noopener">Cocoapods Guides</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://github.com/Qiyun2014/2019/02/15/直播画质评估/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Qiyun">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="祁云的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/15/直播画质评估/" itemprop="url">直播画质评估</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-02-15T16:01:28+08:00">
                2019-02-15
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/02/15/直播画质评估/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2019/02/15/直播画质评估/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p><a href="https://medium.com/netflix-techblog/toward-a-practical-perceptual-video-quality-metric-653f208b9652" target="_blank" rel="noopener">Toward A Practical Perceptual Video Quality Metric</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">采用由网飞（Netfix）开源项目（Vmaf）对视频进行画质打分。</span><br></pre></td></tr></table></figure>
<p>==直播中对画质影响较大的因素：编码和网络==</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">针对弱网环境下的直播体验, 可以改用quic协议； 替换原有的rtmp基于tcp的协议，优化由tcp产生的网络延迟引起的直播卡顿现象。</span><br><span class="line"></span><br><span class="line">而对于编码，进行x264和VideoToolBox（iOS）和VP9（Android）等不同方式下的直播图像数据，才有Vmaf进行打分，获取最佳配置项。</span><br></pre></td></tr></table></figure>
<h2 id="编码质量"><a href="#编码质量" class="headerlink" title="编码质量"></a>编码质量</h2><p>编码器最重要的五个参数：画质级别、码率、帧率、GOP大小、B帧、码控方式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">画质级别：H.264 有四种画质级别，Baseline profile，Extended profile，Main profile，High profile，级别越高，压缩的效果越好，但算法复杂度更高，导致功耗也更高。</span><br><span class="line"></span><br><span class="line">码率：决定了视频被压缩的程度，码率越低，丢失的信息也就越多，画质也就越差。但是，带来的好处是占用的网络带宽会比较小，容易在互联网上传输，不容易出现卡顿。</span><br><span class="line"></span><br><span class="line">帧率：决定了视频的流畅性，帧率越高，视频越流畅，但每秒钟编码器要处理的数据量也就越大，同等码率下压缩出来的视频质量就越差。</span><br><span class="line"></span><br><span class="line">GOP 大小：决定了视频的延时，GOP 越小，延时就越小，但 GOP 小带来的问题是关键帧数量多，数据量变大，因此，同等码率下压缩出来的视频质量就会越差。</span><br><span class="line"></span><br><span class="line">B帧：决定视频的压缩率，b帧越多，直播的带宽成本越低，同时直播延时会变大； x264有三种b帧安放策略，可根据实际情形抉择。</span><br><span class="line"></span><br><span class="line">码控方式：一般编码器都有固定码率（CBR） 和 动态码率（VBR） 两种码控方式，前者是指码率优先，为了保证码率尽可能稳定，会主动降低画质，因此容易出现马赛克，后者是指画质优先，会优先保证画质，减少马赛克，但码率会浮动很大。</span><br></pre></td></tr></table></figure>
<h2 id="流程设计"><a href="#流程设计" class="headerlink" title="流程设计"></a>流程设计</h2><ol>
<li>手机端存储编码前的YUV数据（原始图像数据）</li>
<li>手机端配置编码参数</li>
<li>编码后的数据h264进行解码后存储为YUV（编码图像数据）</li>
<li>pc端两者图像数据比较</li>
</ol>
<p><img src="https://ws2.sinaimg.cn/large/006tNc79gy1fz88mfo3twj30ym0u0jt8.jpg" alt></p>
<h2 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h2><p>我使用iPhone 6s plus机型在软、硬编码下进行相关评测，以下的打分情况。</p>
<p><img src="https://ws2.sinaimg.cn/large/006tKfTcgy1g076mm2f37j30u015a449.jpg" alt> </p>
<h2 id="耗电量评测"><a href="#耗电量评测" class="headerlink" title="耗电量评测"></a>耗电量评测</h2><p>软编码相比较硬编码而言，在低分辨率的情况下表现要强于硬编。但最大的缺陷就是cpu占用高，极大的影响了手机功耗。</p>
<p><img src="https://ws1.sinaimg.cn/large/006tKfTcgy1g077cs467pj30lr0evjsz.jpg" alt></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://github.com/Qiyun2014/2019/02/15/iOS中使用OpenGl-ES2-0-共享资源引起的绿屏现象处理/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Qiyun">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="祁云的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/15/iOS中使用OpenGl-ES2-0-共享资源引起的绿屏现象处理/" itemprop="url">iOS中使用OpenGl ES2.0 共享资源引起的绿屏现象处理</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-02-15T15:27:41+08:00">
                2019-02-15
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/02/15/iOS中使用OpenGl-ES2-0-共享资源引起的绿屏现象处理/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2019/02/15/iOS中使用OpenGl-ES2-0-共享资源引起的绿屏现象处理/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="OpenGL-ES渲染在iOS上共享资源"><a href="#OpenGL-ES渲染在iOS上共享资源" class="headerlink" title="OpenGL ES渲染在iOS上共享资源"></a>OpenGL ES渲染在iOS上共享资源</h1><h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>短视频拍摄中，需要播放录制的视频，因为播放时有多种编辑方式，不能使用系统以及第三方工具实现。从文件中读取视频的每一帧进行自定义渲染，此操作基于opengl开发。<br>拍摄后的视频进入鱼吧后再次进入拍摄页面，画面会出现绿屏的现象，类似着色器的buffer存储信息被重置。</p>
<h3 id="名词解释"><a href="#名词解释" class="headerlink" title="名词解释"></a>名词解释</h3><h4 id="管线（Pipeline）"><a href="#管线（Pipeline）" class="headerlink" title="管线（Pipeline）"></a>管线（Pipeline）</h4><blockquote>
<p>可以理解为将三维空间中表达的数据（比如三维物体、灯光配备等）经由这个管道转换为二维屏幕上的画面。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 创建program</span><br><span class="line">self.program = glCreateProgram();</span><br></pre></td></tr></table></figure>
<p>图像渲染管线的概念：<br>图形渲染管线的主要功能就是决定在给定虚拟相机、三维物体、光源、照明模式，以及纹理<br>等诸多条件的情况下，生成或绘制一幅二维图像的过程。在概念上可以将图形渲染管线分为<br>三个阶段:应用程序阶段、几何阶段、光栅化阶段。</p>
<blockquote>
<p>应用程序阶段（The Application Stage）<br>集合阶段（The Geometry Stage）<br>光栅化阶段（The Rasterizer Stage）</p>
</blockquote>
<h4 id="glContext"><a href="#glContext" class="headerlink" title="glContext"></a>glContext</h4><blockquote>
<p>OpenGL ES的每种实现，都会有个方法，来创建渲染图形的上下文，从而可以管理Opengl ES指定的状态。通过放置这些状态到上下文中，这样在多任务的情况下，就很容易的共享图像的硬件设备，从而互不影响各自的状态。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">// iOS中设置当前上下文的方式</span><br><span class="line">[EAGLContext setCurrentContext:_context]</span><br><span class="line"></span><br><span class="line">// 设置opengl es的渲染特效（1.0或者2.0）</span><br><span class="line"> EAGLContext* CreateBestEAGLContext()&#123;</span><br><span class="line">    EAGLContext *context;</span><br><span class="line">    context = [[EAGLContext alloc] initWithAPI:kEAGLRenderingAPIOpenGLES2];</span><br><span class="line">    if (context == nil)&#123;</span><br><span class="line">        context = [[EAGLContext alloc] initWithAPI:kEAGLRenderingAPIOpenGLES1];</span><br><span class="line">    &#125;</span><br><span class="line">    return context;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>Opengl ES 2.0移除了ES 1.0中所有的处理图像的固定功能流水线（也就是对顶点和纹理进行处理的变换引擎）的函数。并且增加了许多新的函数，以便于提供一个更清晰的着色接口。</code></p>
<h4 id="EAGLSharegroup"><a href="#EAGLSharegroup" class="headerlink" title="EAGLSharegroup"></a>EAGLSharegroup</h4><blockquote>
<p>尽管上下文保存了Openggl ES的状态，但是它不能直接管理Opengl ES的对象。相反，Openggl ES对象是通过EAGLSharegroup对象创建和管理的。每一个上下文都包含了一个EAGLSharegroup对象。</p>
<p>当两个或多个上下文引用同一个共享组时，共享组的优势变得明显，如下图所示。当多个上下文连接到公共共享组时，任何上下文创建的OpenGL ES对象都可在所有上下文中使用;如果在另一个上下文中绑定到相同的对象标识符而不是创建它的那个上下文，则引用相同的OpenGL ES对象。移动设备上的资源往往很少;在多个上下文中创建相同内容的多个副本是浪费的。共享公共资源可以更好地利用设备上可用的图形资源。</p>
</blockquote>
<p>A sharegroup is an opaque object; it has no methods or properties that your app can call. Contexts that use the sharegroup object keep a strong reference to it.</p>
<p>两个Context共同使用OpenGL ES 对象</p>
<p><img src="https://ws3.sinaimg.cn/large/0069RVTdgy1fua6woudrbj30lt0bb0tk.jpg" alt></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// Set the context into which the frames will be drawn.</span><br><span class="line">// All contexts associated with the same sharegroup must use the same version of the OpenGL ES API as the initial context.</span><br><span class="line">_context = [[EAGLContext alloc] initWithAPI:kEAGLRenderingAPIOpenGLES2 sharegroup:[[EAGLContext currentContext] sharegroup]];</span><br><span class="line"></span><br><span class="line">// Creating two contexts with a common sharegroup</span><br><span class="line">EAGLContext* firstContext = CreateBestEAGLContext();</span><br><span class="line">EAGLContext* secondContext = [[EAGLContext alloc] initWithAPI:[firstContext API] sharegroup: [firstContext sharegroup]];</span><br></pre></td></tr></table></figure>
<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>当使用EAGLContext的时候我们并不能直接管理opengl es的对象，需要创建EAGLSharegroup进行管理，避免出现opengl es对象出错的情况下无法直接去管理它。<br>当共享组是被多个上下文共享时，你的应用程序就有义务要管理Opengl ES对象状态的改变。规则如下：</p>
<blockquote>
<ol>
<li><p>当你的应用程序可能要通过多个上下文进入某个对象的同时，要确保对象没有被同时改变。</p>
</li>
<li><p>当对象要被发给上下文的命令改变时，对象此时不能被另外的上下文读取或者改变。</p>
</li>
<li><p>在一个对象被改变时，必须是被绑定对象的所有的上下文才能看到这些改变。如果一个上下文在绑定之前就引用它，那么这个对象的内容是没有被定义的。</p>
</li>
</ol>
</blockquote>
<p>更新Opengl ES对象需要遵循的：</p>
<blockquote>
<ol>
<li>在每一个可能使用该对象的上下文中调用glFlush方法</li>
<li>在某个上下文想要改变对象的同时，调用一个或者更多的Opengl ES的函数来改变对象</li>
<li>在接收到上下文状态改变的通知时，调用glFlush函数</li>
<li>在每个其他的上下文中，绑定对象的标志。</li>
</ol>
</blockquote>
<p>==注意：共享对象的另一个方法是去使用单一的渲染上下文，但是多个目的缓冲帧。在渲染时，你的应用程序绑定需要的缓冲帧，然后渲染成需要的帧。因为所有的Opengl ES对象都是从单一的上下文中渲染的，所以他们看到的是同样的Opengl ES的数据。这个方式使用的资源很少，但是仅仅对单线程的应用程序有用，在单线程中你可以很好的控制上下文的状态。==</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://github.com/Qiyun2014/2019/02/15/ImageMagick-7-0-7-16使用/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Qiyun">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="祁云的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/15/ImageMagick-7-0-7-16使用/" itemprop="url">ImageMagick 7.0.7-16使用</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-02-15T15:08:48+08:00">
                2019-02-15
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/02/15/ImageMagick-7-0-7-16使用/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2019/02/15/ImageMagick-7-0-7-16使用/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="ImageMagick-7-0-7-16使用"><a href="#ImageMagick-7-0-7-16使用" class="headerlink" title="ImageMagick 7.0.7-16使用"></a>ImageMagick 7.0.7-16使用</h2><p><strong>相关链接</strong></p>
<ul>
<li>HomePage: <a href="https://www.imagemagick.org/script/index.php" target="_blank" rel="noopener">https://www.imagemagick.org/script/index.php</a></li>
<li>Download: <a href="https://github.com/ImageMagick/ImageMagick">https://github.com/ImageMagick/ImageMagick</a></li>
</ul>
<p>##安装<br>    •brew install ImageMagick</p>
<p>##使用</p>
<p><strong>Edge Detection</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">convert input.png -colorspace gray -canny 0x1+10%+30% output.png</span><br></pre></td></tr></table></figure></p>
<p><strong>Compositon Image</strong></p>
<p>把一张图片按80的质量去压缩(jpg的压缩参数),同时按图片比例非强制缩放成不超过280x140的图片.居中裁剪280x140,去掉图片裁减后的空白和图片exif信息,通常这种指令是为了保证图片大小正好为280x140<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">convert +profile &apos;*&apos; /Users/qiyun/Desktop/屏幕快照\ 2018-01-03\ 下午2.04.04.png -quality 80 -resize &apos;280x140^&gt;&apos; -gravity Center -crop 280x140+0+0 +repage /Users/qiyun/Desktop/新图片.jpg</span><br></pre></td></tr></table></figure></p>
<p><code>-quality   图片质量,jpg默认99,png默认75
-resize
100x100      高度和宽度比例保留最高值，高比不变
100x100^     高度和宽度比例保留最低值，宽高比不变
100x100!     宽度和高度强制转换，忽视宽高比
100x100&gt;     更改长宽，当图片长或宽超过规定的尺寸
100x100&lt;     更改长宽 只有当图片长宽都超过规定的尺寸
100x100^&gt;    更改长宽，当图片长或宽超过规定的尺寸。高度和宽度比例保留最低值
100x100^&lt;    更改长宽，只有当图片长宽都超过规定的尺寸。高度和宽度比例保留最低值
100          按指定的宽度缩放，保持宽高比例
x100         按指定高度缩放，保持宽高比
-gravity NorthWest, North, NorthEast, West, Center, East,  SouthWest, South, SouthEast截取用的定位指令,定位截取区域在图片中的方位
-crop 200x200+0+0 截取用的截取指令 ,在用定位指令后,按后两位的偏移值偏移截取范围左上角的像素后,再按前两位的数值,从左上角开始截取相应大小的图片
+repage         去掉图片裁减后的空白
-dissolve 30    设定组合图片透明度dissolve示例
+/-profile *    去掉/添加图片exif信息</code></p>
<p><strong>把原始图片分割成多张小图</strong></p>
<pre><code>•convert src.jpg -crop 100x100 dest.jpg
</code></pre><p>假设src.jpg的大小是300x200,执行命令后将得到名为dest-0.jpg、dest-1.jpg…dest-5.jpg的6张大小为100x100的小图片。注意如果尺寸不是目标图片的整数倍，那么右边缘和下边缘的一部分图片就用实际尺寸</p>
<p><strong>在原始图片上剪裁一张指定尺寸的小图</strong></p>
<pre><code>•convert src.jpg -crop 100x80+50+30 dest.jpg
</code></pre><p>在原始图片的上距离上部30像素左部50为起点的位置,分别向右向下截取一块大小为100x80的图片。如果x相对于坐标，宽度不够100，那就取实际值。</p>
<pre><code>•convert src.jpg -gravity center -crop 100x80+0+0 dest.jpg
</code></pre><p>在原始图上截取中心部分一块100x80的图片</p>
<pre><code>•convert src.jpg -gravity southeast -crop 100x80+10+5 dest.jpg
</code></pre><p>在原始图上截取右下角距离下边缘10个像素，右边缘5个像素一块100x80的图片</p>
<p><strong>图片进行反色处理</strong></p>
<pre><code>•convert -negate src.jpg negate.jpg
</code></pre><p>##示例</p>
<p><strong>转换rgb为灰度图</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">计算公式 &gt;&gt; Grey = (R*38 + G*75 + B*15)&gt;&gt; 7</span><br><span class="line">convert /Users/qiyun/Desktop/屏幕快照\ 2018-02-23\ 下午2.51.29.png -set colorspace Gray -separate -average 1111.jpeg</span><br></pre></td></tr></table></figure>
<p><strong>-crop参数是从一个图片截取一个指定区域的子图片</strong><br> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">格式如下:convert -crop widthxheight&#123;+-&#125;x&#123;+-&#125;y&#123;%&#125;</span><br></pre></td></tr></table></figure></p>
<p> <em>width 子图片宽度</em> <em>height 子图片高度</em><br> x 为正数时为从区域左上角的x坐标,为负数时,左上角坐标为0,然后从截出的子图片右边减去x象素宽度. y 为正数时为从区域左上角的y坐标,为负数时,左上角坐标为0,然后从截出的子图片上边减去y象素高度.  如convert -crop 300x400+10+10 src.jpg dest.jpg 从src.jpg坐标为x:10 y:10截取300x400的图片存为dest.jpg convert -crop 300x400-10+10 src.jpg dest.jpg 从src.jpg坐标为x:0 y:10截取290x400的图片存为dest.jpg</p>
<p>##总结</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://github.com/Qiyun2014/2019/02/15/如何高效的使用硬编码进行数据压缩/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Qiyun">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="祁云的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/15/如何高效的使用硬编码进行数据压缩/" itemprop="url">如何高效的使用硬编码进行推流</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-02-15T15:08:48+08:00">
                2019-02-15
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/02/15/如何高效的使用硬编码进行数据压缩/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2019/02/15/如何高效的使用硬编码进行数据压缩/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="如何高效的使用硬编码进行推流"><a href="#如何高效的使用硬编码进行推流" class="headerlink" title="如何高效的使用硬编码进行推流"></a>如何高效的使用硬编码进行推流</h1><h2 id="背景介绍"><a href="#背景介绍" class="headerlink" title="背景介绍"></a>背景介绍</h2><p>从摄像头和麦克风获取的音视频数据（YUV、PCM）因原始数据体积较大，不适合直接在网络进行传输。</p>
<p><img src="https://ws4.sinaimg.cn/large/006tNbRwgy1fxurz839d2j30oi0hptbd.jpg" alt></p>
<p>在直播中实时传输音视频，需要将音视频流分解成小块数据包，而原始数据需要添加音视频同步信息保证接收端能还原出完整的音视频流。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">所以，获取的音视频数据需要分辨进行编码，目前编码比较高效的音视频方式分辨是h264和aac。</span><br><span class="line"></span><br><span class="line">编码后的数据，相比原始数据进行很大程度的压缩，将压缩的数据以一定格式进行封装，进行muxer后通过rtmp协议推送到服务端。</span><br></pre></td></tr></table></figure>
<h3 id="推流参数介绍"><a href="#推流参数介绍" class="headerlink" title="推流参数介绍"></a>推流参数介绍</h3><ul>
<li><p><strong>FPS</strong>：视频每秒包含多少帧，一帧就是一个静态的图像；</p>
</li>
<li><p><strong>I帧，B帧和P帧</strong>：I帧是靠尽可能去除图像空间冗余信息来压缩传输数据量的帧内编码图像； P帧是通过充分降低与图像序列中前面已编码帧的时间冗余信息来压缩传输数据量的编码图像，也叫预测帧； B帧是既考虑与源图像序列前面已编码帧，也顾及源图像序列后面已编码帧之间的时间冗余信息来压缩传输数据量的编码图像，也叫双向预测帧；一般地，I帧压缩效率最低，P帧较高，B帧最高。I帧是通过帧内预测编码的，在获取到I帧后能解码出相应的图像，而P帧和B帧需要依赖相邻的帧才能解码出图像；</p>
</li>
<li><p><strong>GOP</strong>：( <strong>Group of Pictures </strong>) 是一组连续的画面，由一张 I 帧和数张 B / P 帧组成，是视频图像编码器和解码器存取的基本单位，它的排列顺序将会一直重复到影像结束。</p>
</li>
<li><p><strong>GOP</strong>间隔：是指一个画面序列中相邻两个I帧的间隔时间。</p>
</li>
<li><p><strong>封装格式</strong>：音视频文件封装格式有<strong>avi</strong>、<strong>rmvb</strong>、<strong>flv</strong>、<strong>mkv</strong>、<strong>MP4</strong>等等，封装格式就是把音视频数据打包成一个文件的规范。一般会包含音视频编码类型，时间戳，采样率等信息，方便接收方解析出原始数据。</p>
</li>
<li><p><strong>视频码率</strong>：码率的单位为<strong>kbps</strong>，指每秒视频数据量，其值跟每秒视频帧数FPS，图像分辨率以及编码器压缩率有关。</p>
</li>
</ul>
<h2 id="硬编码"><a href="#硬编码" class="headerlink" title="硬编码"></a>硬编码</h2><p>为了保证高清画质的视频数据在网络中达到实时直播的效果，且满足蜂窝网络、wifi下的正常使用。</p>
<p>需要对图像进行编码，也就是压缩。</p>
<p>常用的压缩算法有<strong>h264</strong>、<strong>HEVC</strong>、<strong>VP8</strong>、<strong>VP9</strong>等等。</p>
<p><img src="https://ws3.sinaimg.cn/large/006tNbRwgy1fxus21trxtj30oa0gsacv.jpg" alt></p>
<p><strong>以iOS为例，目前仅支持H264硬编码，ffmpeg实现软编码（H264、H265)</strong></p>
<p><strong>在移动端使用，软编码占用CPU性能非常高，硬编码完全依赖GPU进行像素数据处理，速度会更快。</strong></p>
<h2 id="编码等级"><a href="#编码等级" class="headerlink" title="编码等级"></a>编码等级</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">H.264有四种画质级别，分别是BP、EP、MP、HP：</span><br></pre></td></tr></table></figure>
<p>在下面三种级别进行编码时，对应的耗电数据如下：</p>
<p><img src="https://ws3.sinaimg.cn/large/006tNbRwgy1fxuslp4kuxj30ob0ay404.jpg" alt></p>
<p><strong>高级别的画质，对数据保留完整度更高</strong></p>
<h3 id="CABAC和CAVLC比较"><a href="#CABAC和CAVLC比较" class="headerlink" title="CABAC和CAVLC比较"></a>CABAC和CAVLC比较</h3><p><img src="https://ws3.sinaimg.cn/large/006tNbRwgy1fxuswsvt2bj30od0gpdjm.jpg" alt></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">越高的编码等级编解码越复杂，压缩率越高，同样的网络速率能传输更多的视频信息；</span><br><span class="line"></span><br><span class="line">CABAC充分发挥算术编码压缩效率高的特点，而且其基于上下文的特点使其可以充分利用不同视频流的统计特性和符号间的相关性，自适应不同符号（消息）出现的概率。</span><br><span class="line"></span><br><span class="line">因此，CABAC的编码性能更好。</span><br></pre></td></tr></table></figure>
<p><strong>选择节能而码率相对较大的情况下，CAVLC明显更适合；<br>选择带宽节省的情况，CABAC无疑更好。</strong></p>
<p><strong>CABAC虽然性能很好，但也存在不足：</strong></p>
<ul>
<li>复杂度过高，不易并行处理。存在块及依赖（左/上角的块没有码率估计/熵编码, 后继块就无法得到更新后的状态，从而无法开始码率估计/上编码）、Bin级依赖（统一个子队列的bin存在前后依赖性，后继的Bin要等前面Bin编完后才能得到更新后的上下文状态）以及编码的几个环节依赖，这些依赖性会影响编码器的并行实现。</li>
<li>计算精度问题。为简化计算，CABAC采用128个状态来近似，根据原来状态和当前符号性质查表得到下个状态，这个过程会有一定程度的精度损失。</li>
<li>Context的利用频率过高或过低。</li>
</ul>
<h3 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1. 根据当前网络环境，设置对应的实时码率能有效的解决直播卡顿、带宽成本的问题。</span><br><span class="line">2. 不同的分辨率、帧率、GOP需要谨慎决策，能对直播带来良好的体验。</span><br><span class="line">3. CABAC和CAVLC的选择需要取舍（带宽还是功耗）</span><br><span class="line">4. HEVC相比VP9差别不大，但VP9谷歌开源，HEVC却有非常多的专利机构，使用成本较高。但两者相比H264，有显著程度的提高。</span><br><span class="line">5. HEVC迟早会替代H264。</span><br></pre></td></tr></table></figure>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a href="https://books.google.com/books?id=ysFeDwAAQBAJ&amp;pg=PT54&amp;lpg=PT54&amp;dq=cavlc+cabac比较&amp;source=bl&amp;ots=YIU0up78TW&amp;sig=AaFvh7527Oel2K-HaE5U1RUXeDs&amp;hl=zh-CN&amp;sa=X&amp;ved=2ahUKEwj2-6KloYXfAhVqx1QKHRQFACEQ6AEwCHoECAEQAQ#v=onepage&amp;q=cavlc%20cabac比较&amp;f=false" target="_blank" rel="noopener">网络电视技术</a></p>
<p><a href="https://www.jianshu.com/p/7450fd22ffc6" target="_blank" rel="noopener">算术编码 CABAC CAVLC</a></p>
<p><a href="http://www.lighterra.com/papers/videoencodingh264/" target="_blank" rel="noopener">H264视频编码设置</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://github.com/Qiyun2014/2019/02/15/第三方音乐软件播放导致直播中断/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Qiyun">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="祁云的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/15/第三方音乐软件播放导致直播中断/" itemprop="url">第三方音乐软件播放导致直播中断</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-02-15T15:08:48+08:00">
                2019-02-15
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/02/15/第三方音乐软件播放导致直播中断/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2019/02/15/第三方音乐软件播放导致直播中断/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="现象"><a href="#现象" class="headerlink" title="现象"></a>现象</h2><p><img src="https://ws4.sinaimg.cn/large/006tNbRwgy1fxdgblht5ej30go0tn47f.jpg" alt="-w240"> <img src="https://ws3.sinaimg.cn/large/006tNbRwgy1fxdgbn3mqkj30go0tnh2h.jpg" alt="-w240"> <img src="https://ws4.sinaimg.cn/large/006tNbRwgy1fxdgbr7vc7j30go0tnn65.jpg" alt="-w240"></p>
<p>音频开播（最左）<br>退入到后台后<br>打开qq音乐并选择音乐进行播放（中间）<br>退入后台<br>回到斗鱼app（最右）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">开播时，观众可以正常听到主播的声音。</span><br><span class="line">开启qq音乐后，观众端一直处于“鲨鱼娘努力加载中...”的场景，并无法恢复直播。</span><br></pre></td></tr></table></figure>
<h2 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h2><p>麦克风（播放和录制）、耳机（插入和拔出）都会通知Device进行指令接收，进行扬声器播放或者耳机音频数据传输。</p>
<p>可以使用音频会话向系统传达打算如何在应用中使用音频。<br>此音频会话充当应用和操作系统之间的中介 - 进而是底层音频硬件。<br>可以使用它来向操作系统传达应用程序音频的性质，而无需详细说明特定行为或与音频硬件的所需交互。将这些细节的管理委派给音频会话可确保最佳地管理用户的音频体验。</p>
<p><img src="https://ws2.sinaimg.cn/large/006tNbRwgy1fxdgtafs5ij30pf0j3ac5.jpg" alt="-w600"></p>
<pre><code>•    Configure the audio session category and mode to communicate to the system how you intend to use audio in your app
•    Activate your app’s audio session to put your category and mode configuration into action
•    Subscribe and respond to important audio session notifications, such as audio interruptions and route changes
•    Perform advanced audio device configuration such as setting sample rate, I/O buffer duration, and number of channels
</code></pre><h4 id="打断场景"><a href="#打断场景" class="headerlink" title="打断场景"></a>打断场景</h4><p><img src="https://ws1.sinaimg.cn/large/006tNbRwgy1fxdhwy63emj30tz0hqq50.jpg" alt="-w600"></p>
<p>当直播库录制时，会创建一个session用于向系统传达指令。这个session在系统级的Device的session之上。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">开启直播，就会开启session；</span><br><span class="line"></span><br><span class="line">第三方音乐应用开启，会创建自己的session，抢占当前我们直播的session，导致直播音频录制停止。</span><br><span class="line"></span><br><span class="line">Facetime或者来电等请求接收时，设备的session会下发通知，当前有更底层的session需要使用，我们直播的session会被打断，导致直播音频录制停止。如果用户主动拒绝这些请求，打断会恢复，直播继续。</span><br></pre></td></tr></table></figure>
<p>==出现无法直播的的问题就是第三方音乐app抢占了session，直播直接停止==</p>
<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p><img src="https://ws2.sinaimg.cn/large/006tNbRwgy1fxdi8iegqhj315v080tat.jpg" alt></p>
<p>iOS系统支持后台模式以及播放和录制情形共同使用的场景</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1. 为了保证音频录制能在iOS系统后台持续工作，首先需要开启UIBackgroundModes配置，保证应用在静音、锁屏下正常使用。</span><br><span class="line">2. 监听当前Session的状态，是否打断、恢复</span><br><span class="line">3. 监听当前应用Active，第一时间响应app进入前后台的工作场景</span><br><span class="line">4. 回到前台时，重新启动Session并且设置Category允许Record和Play</span><br><span class="line">5. reactivate当前的AudioSession</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">AVAudioSession *session = [AVAudioSession sharedInstance];</span><br><span class="line">[session setCategory:AVAudioSessionCategoryPlayAndRecord withOptions:AVAudioSessionCategoryOptionMixWithOthers | AVAudioSessionCategoryOptionAllowBluetooth error:nil];</span><br><span class="line">[session setActive:YES error:nil];</span><br></pre></td></tr></table></figure>
<h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><p><a href="https://developer.apple.com/library/archive/documentation/Audio/Conceptual/AudioSessionProgrammingGuide/HandlingAudioInterruptions/HandlingAudioInterruptions.html" target="_blank" rel="noopener">https://developer.apple.com/library/archive/documentation/Audio/Conceptual/AudioSessionProgrammingGuide/HandlingAudioInterruptions/HandlingAudioInterruptions.html</a></p>
<p><a href="https://developer.apple.com/library/archive/documentation/Audio/Conceptual/AudioSessionProgrammingGuide/AudioSessionCategoriesandModes/AudioSessionCategoriesandModes.html" target="_blank" rel="noopener">https://developer.apple.com/library/archive/documentation/Audio/Conceptual/AudioSessionProgrammingGuide/AudioSessionCategoriesandModes/AudioSessionCategoriesandModes.html</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://github.com/Qiyun2014/2019/02/15/机器学习之开源项目/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Qiyun">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="祁云的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/15/机器学习之开源项目/" itemprop="url">机器学习开源项目</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-02-15T15:08:48+08:00">
                2019-02-15
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/02/15/机器学习之开源项目/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2019/02/15/机器学习之开源项目/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>##开源项目</p>
<p>###开源框架</p>
<ul>
<li><p>OpenCV [GitHub - opencv/opencv: Open Source Computer Vision Library] (<a href="https://github.com/opencv/opencv">https://github.com/opencv/opencv</a>)</p>
</li>
<li><p>dlib [GitHub - davisking/dlib: A toolkit for making real world machine learning and data analysis applications in C++] (<a href="https://github.com/davisking/dlib">https://github.com/davisking/dlib</a>)</p>
</li>
<li><p>[Scikit-Learn] (<a href="https://github.com/scikit-learn/scikit-learn">https://github.com/scikit-learn/scikit-learn</a>)<br> Scikit-Learn是用于机器学习的Python模块，它建立在SciPy之上。</p>
</li>
<li><p>[Caffe] (<a href="https://github.com/BVLC/caffe">https://github.com/BVLC/caffe</a>)<br> Caffe是由神经网络中的表达式、速度、模块化产生的深度学习框架。</p>
</li>
<li><p>[Mxnet] (<a href="https://github.com/apache/incubator-mxnet">https://github.com/apache/incubator-mxnet</a>)</p>
</li>
<li><p>[Tensorflow] (<a href="https://github.com/search?utf8=✓&amp;q=tensorflow">https://github.com/search?utf8=✓&amp;q=tensorflow</a>)<br> TensorFlow是谷歌发布的第二代机器学习系统。</p>
</li>
<li><p>[PredictionIO] (<a href="https://github.com/PredictionIO/PredictionIO">https://github.com/PredictionIO/PredictionIO</a>)<br> PredictionIO是面向开发人员和数据科学家的开源机器学习服务器。它支持事件采集、算法调度、评估，以及经由REST APIs的预测结果查询。</p>
</li>
<li><p>[Keras] (<a href="https://github.com/fchollet/keras">https://github.com/fchollet/keras</a>)<br> Keras是极其精简并高度模块化的神经网络库，在TensorFlow或Theano上都能够运行，是一个高度模块化的神经网络库，支持GPU和CPU运算。</p>
</li>
</ul>
<p>###视觉检测和追踪</p>
<ul>
<li>RCNN，[Fast-RCNN，Faster-RCNN 现在最主流的检测框架，GitHub - rbgirshick/py-faster-rcnn: Faster R-CNN (Python implementation) – see <a href="https://github.com/ShaoqingRen/faster_rcnn">https://github.com/ShaoqingRen/faster_rcnn</a> for the official MATLAB version] (<a href="https://github.com/rbgirshick/py-faster-rcnn">https://github.com/rbgirshick/py-faster-rcnn</a>)</li>
<li>SSD，达到实时的检测算法，[GitHub - weiliu89/caffe at ssd] (<a href="https://github.com/weiliu89/caffe/tree/ssd">https://github.com/weiliu89/caffe/tree/ssd</a>)</li>
<li>DPM，早期的检测算法，使用 latent SVM [GitHub - rbgirshick/voc-dpm: Object detection system using deformable part models (DPMs) and latent SVM (voc-release5). You may want to use the latest tarball on my website. The github code may include code changes that have not been tested as thoroughly and will not necessarily reproduce the results on the website.] (<a href="https://github.com/rbgirshick/voc-dpm">https://github.com/rbgirshick/voc-dpm</a>)</li>
<li>TLD，非常鲁棒的跟踪算法 [GitHub - zk00006/OpenTLD: Official source code for TLD] (<a href="https://github.com/zk00006/OpenTLD">https://github.com/zk00006/OpenTLD</a>)</li>
</ul>
<p>###2018二月份最火的项目</p>
<ol>
<li><p>[FastPhotoStyle] (<a href="https://github.com/NVIDIA/FastPhotoStyle)（快速转换照片风格）">https://github.com/NVIDIA/FastPhotoStyle)（快速转换照片风格）</a></p>
<p>  FastPhotoStyle 这个项目是英伟达（NVIDIA）开发的一个 Python 库。该模型将内容照片和风格照片作为输入。然后它将风格照片的风格转移到内容照片，即就是将内容照片的风格转换为我们输入的风格照片的风格。</p>
<p>  开发人员举出了两个算法示例。首先，第一个是非常简单的迭代算法，只需要下载一张内容图和风格图，重新调整他们尺寸，然后运行图像风格化代码。第二个样例中，需要使用语义标签映射来创建程式化图像。</p>
<p>  <img src="https://ws2.sinaimg.cn/large/006tNc79gy1fqs4qi9mw8j30pj0oz0zy.jpg" alt></p>
</li>
</ol>
<ol start="2">
<li><p>[Twitter Scraper] (<a href="https://github.com/kennethreitz/twitter-scraper)（Twitter">https://github.com/kennethreitz/twitter-scraper)（Twitter</a> 爬虫）</p>
<p> 如果你在 Twitter 上发过文章，就知道 Twitter 自身的 API 有流速限制，当然，作为国内用户大多数人都没用使用过 Twitter ，这个 Python 库就是考虑到这一点，它没有 API 限流（不需要任何身份验证），也没有限制，并且速度非常快。开发人员可以用这个库爬取任何用户的任意一条 Twitter （推文）。<br> 而且，这个项目可以用于制作马尔科夫链，但是目前它只能适用于 Python 3.6 及以上版本。</p>
</li>
<li><p>[Handwriting Synthesis] (<a href="https://github.com/sjvasquez/handwriting-synthesis)（手写体合成）">https://github.com/sjvasquez/handwriting-synthesis)（手写体合成）</a></p>
<p> 这个项目来自亚历克斯 · 格雷夫斯（Alex Graves）撰写的论文（Generating Sequences with Recurrent Neural Networks）《用 RNN 生成序列》，正如存储库的名称所示，您可以生成不同风格的手写，是其中手写体合成实验的实现，它可以生成不同风格的手写字迹。模型包括初始化和偏置两个部分，其中初始化控制样例的风格，偏置控制样例的整洁度。作者在 GitHub 页面上呈现的样本的多样性真的很吸引人。他正在寻找贡献者来加强存储库，所以如果您有兴趣，可以研究去看看。</p>
<p> <img src="https://ws4.sinaimg.cn/large/006tNc79gy1fqs4qv0lcqj30gq0acab2.jpg" alt></p>
</li>
<li><p>[ENAS PyTorch] (<a href="https://github.com/carpedm20/ENAS-pytorch)（高效神经网络结构搜索）">https://github.com/carpedm20/ENAS-pytorch)（高效神经网络结构搜索）</a></p>
<p> 该项目是对论文《参数共享的高效神经网络结构搜索（Efficient Neural Architecture Search (ENAS) via Parameters Sharing）》的实现。ENAS 做什么？高效神经网络结构搜索，即 ENAS 减少了计算需求，将 NAS 的 GPU 计算时间减少了 1000 倍。他们通过共享大型计算图中的子图模型之间的参数共享来完成此操作。<br> 如何使用它的过程已经在 GitHub 页面上得到了很好的展示。实现这个库的先决条件是：<br> •    Python 3.6+<br> •    需要 PyTorch<br> •    tqdm，imageio，graphviz，tqdm，tensorboardX</p>
<p> <img src="https://ws1.sinaimg.cn/large/006tNc79gy1fqs4r7to4qj30lt08mabq.jpg" alt><br> <img src="https://ws3.sinaimg.cn/large/006tNc79gy1fqs4rikm1sj30qx08ejtg.jpg" alt><br> <img src="https://ws2.sinaimg.cn/large/006tNc79gy1fqs4rttg37g30jy0q5npg.gif" alt="-w360"> <img src="https://ws2.sinaimg.cn/large/006tNc79gy1fqs4sfpdr7g30jl0nfkjq.gif" alt="-w360"></p>
</li>
<li><p><a href="https://github.com/EvilPort2/Sign-Language">Sign Language</a>（手势语言识别）</p>
<p> 这是一个相对简单但又十分吸引人的机器学习项目。在 Python 中使用卷积神经网络构造模型，可以识别手势并将其转换为机器上的文本。该项目存储库的作者用 Tensorflow 和 Keras 共同搭建了 CNN 模型，他特别详细地说明了他是怎么创建这个项目的，以及每一步是怎么进行的。<br> 是不是感觉非常不错的，如果你对机器学习感兴趣，可以去这些开源项目中去研究和学习一下。另外，通过这几个开源项目，我们又一次了解了 Python 的重要性，所以，对于想学编程的读者或者初入职场的计算机学生，可以往 Python 方向学习一下。<br><img src="https://ws4.sinaimg.cn/large/006tNc79gy1fqs4t4h2rpj30e806gdg2.jpg" alt></p>
</li>
</ol>
<p>##shader编程</p>
<ul>
<li><a href="https://www.shadertoy.com" target="_blank" rel="noopener">Shadertoy</a>：视觉技术网站之一，shader 编程共享网站，里面很多很酷的例子。有一些已经被我移植到 opengl es 上了（详见：<a href="https://github.com/nekocode/murmur">nekocode/murmur · GitHub</a>）</li>
<li><a href="https://www.openprocessing.org" target="_blank" rel="noopener">OpenProcessing</a>：图像处理，可视化的话 也不要忘记了 Processing ，这个站点上很多很酷的，甚至可交互的例子，有点 java 底子，又想研究可视化技术的话，它是一个十分经典而且不错的选择</li>
<li><a href="http://transitions.glsl.io" target="_blank" rel="noopener">GLSL.io – Open Collection of GLSL Transitions</a>：也是一个 glsl shader 分享网站，主要关注于图片切换效果上</li>
</ul>
<h2 id="图像缩放"><a href="#图像缩放" class="headerlink" title="图像缩放"></a><a href="https://en.wikipedia.org/wiki/Image_scaling" target="_blank" rel="noopener">图像缩放</a></h2><ul>
<li><a href="https://github.com/nagadomi/waifu2x">Github: nagadomi/waifu2x · GitHub</a></li>
</ul>
<p>使用卷积神经网络(Convolutional Neural Network, CNN)针对漫画风格的图片进行放大.<br>效果还是相当不错的, 下面是官方的Demo图:</p>
<p><img src="https://ws3.sinaimg.cn/large/006tNc79gy1fqs4tiviv0j30cr0r47e4.jpg" alt></p>
<p>##车牌识别<br>EasyPR 开源的中文车牌识别项目,Opencv 实现代码清晰易读。<br><a href="https://github.com/liuruoze/EasyPR">GitHub - liuruoze/EasyPR: An open source project for chinese plate recognition. It aims to be Easy, Flexible, and Accurate. Welcome to contribute your expertise !</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://github.com/Qiyun2014/2019/02/15/音频降噪算法/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Qiyun">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="祁云的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/15/音频降噪算法/" itemprop="url">音频降噪算法</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-02-15T15:08:48+08:00">
                2019-02-15
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/02/15/音频降噪算法/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2019/02/15/音频降噪算法/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="音频降噪算法"><a href="#音频降噪算法" class="headerlink" title="音频降噪算法"></a>音频降噪算法</h1><h2 id="WAV-Waveform-Audio-File-Format"><a href="#WAV-Waveform-Audio-File-Format" class="headerlink" title="WAV (Waveform Audio File Format)"></a>WAV (Waveform Audio File Format)</h2><p>此格式属于资源交换档案格式(RIFF)的应用之一，通常会将采用脉冲编码调制的音频资存储在区块中。<br>也是其音乐发烧友中常用的指定规格之一。<br>由于此音频格式未经过压缩，所以在音质方面不会出现失真的情况，但文件的体积因而在众多音频格式中较为大。</p>
<p><strong>制作WAV文件时，会有一个采样率，根据采样定理，若此采样率低于信号最高频率的两倍时，那么超过此最大频率的频段，将会产生混叠的情况，使原始信号受到污染，亦不能称此WAV文件就是无损文件。</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">WAV文件遵守资源交换档案格式之规则，在文件的前44(或46)字节放置标头(header)，使播放器或编辑器能够简单掌握文件的基本信息，其内容以区块(chunk)为最小单位，每一区块长度为4字节，而区块之上则由子区块包裹，每一子区块长度不拘，但须在前头先宣告标签及长度(字节)。</span><br><span class="line"></span><br><span class="line">标头的前3个区块记录文件格式及长度；</span><br><span class="line">接着第一个子区块包含8个区块，记录声道数量、采样率等信息；</span><br><span class="line">接着第二个子区块才是真正的音频数据，长度则视音频长度而定。</span><br><span class="line"></span><br><span class="line">内容如下表所示。须注意的是，每个区块的端序不尽相同，而音频内容本身则是采用小端序。</span><br></pre></td></tr></table></figure>
<p><img src="https://ws3.sinaimg.cn/large/006tNbRwgy1fy61nb179gj30hx0drjto.jpg" alt></p>
<h2 id="AAC-Advanced-Audio-Coding"><a href="#AAC-Advanced-Audio-Coding" class="headerlink" title="AAC (Advanced Audio Coding)"></a>AAC (Advanced Audio Coding)</h2><p>出现于1997年，为一种基于MPEG-2的有损数字音频压缩的专利音频编码标准。</p>
<ul>
<li><p>.aac - 使用MPEG-2 Audio Transport Stream（ADTS，参见MPEG-2）容器，区别于使用MPEG-4容器的MP4/M4A格式，属于传统的AAC编码（FAAC默认的封装，但FAAC亦可输出MPEG-4封装的AAC）。</p>
</li>
<li><p>.mp4 - 使用了MPEG-4 Part 14（第14部分）的简化版即3GPP Media Release 6 Basic（3gp6，参见3GP）进行封装的AAC编码（Nero AAC编码器仅能输出MPEG-4封装的AAC）。</p>
</li>
<li><p>.m4a - 为了区别纯音频MP4文件和包含视频的MP4文件而由苹果（Apple）公司使用的扩展名，Apple iTunes对纯音频MP4文件采用了”.m4a”命名。M4A的本质和音频MP4相同，故音频MP4文件亦可直接更改扩展名为M4A。</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">作为一种高压缩比的音频压缩算法，AAC压缩比通常为18：1，也有数据说为20：1；</span><br><span class="line"></span><br><span class="line">在音质方面，由于采用多声道，和使用低复杂性的描述方式，使其比几乎所有的传统编码方式在同规格的情况下更胜一筹。</span><br><span class="line"></span><br><span class="line">不过直到2006年，使用这一格式存储音乐的并不多，可以播放该格式的mp3播放器更是少之又少，目前所知仅有苹果iPod、Sony Walkman（NWZ-A、NWZ-S、NWZ-E、NWZ-X系列）、任天堂NDSi和iPhone（微软推出的Windows 7附带的Windows Media Player 12也支持AAC）。</span><br><span class="line"></span><br><span class="line">此外计算机上很多音乐播放软件都支持AAC（前提是安装过AAC解码器），如苹果iTunes。</span><br><span class="line"></span><br><span class="line">但在移动电话领域，AAC的支持度已很普遍，Nokia、Sony Ericsson、Motorola等品牌均在其中高端产品中支持AAC（一开始主要是LC-AAC，随着移动电话性能的发展，HE-AAC的支持也已广泛）。</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">AAC是一种宽带音频编码算法，主要利用以下两种编码策略来大幅减少存储高质量数字音频所需要的数据量：</span><br><span class="line">舍去与感知上无关的信号成分</span><br><span class="line">去除编码后信号的冗余部分</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://github.com/Qiyun2014/2019/02/15/绝地求生存活人数识别Tesseract-OCR/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Qiyun">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="祁云的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/15/绝地求生存活人数识别Tesseract-OCR/" itemprop="url">Tesseract OCR使用介绍</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-02-15T15:08:48+08:00">
                2019-02-15
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/02/15/绝地求生存活人数识别Tesseract-OCR/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2019/02/15/绝地求生存活人数识别Tesseract-OCR/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>#Tesseract OCR使用介绍</p>
<p>##目录<br>[TOC]</p>
<p>##下载地址及介绍</p>
<ul>
<li>官网介绍：<a href="http://code.google.com/p/tesseract-ocr/wiki/TrainingTesseract3" target="_blank" rel="noopener">http://code.google.com/p/tesseract-ocr/wiki/TrainingTesseract3</a></li>
<li>Github源码连接： <a href="https://github.com/tesseract-ocr">https://github.com/tesseract-ocr</a></li>
<li>开源贡献者主页 <a href="https://kevintechnology.com/" target="_blank" rel="noopener">https://kevintechnology.com/</a></li>
</ul>
<p>##安装 Tesseract</p>
<ul>
<li>语言包查看 <a href="https://www.macports.org/ports.php?by=name&amp;substr=tesseract-" target="_blank" rel="noopener">https://www.macports.org/ports.php?by=name&amp;substr=tesseract-</a></li>
<li>支持Windows、linux、macOS</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">1、安装 tesseract和语言包</span><br><span class="line">sudo port install tesseract	</span><br><span class="line">sudo port install tesseract-&lt;langcode&gt;</span><br><span class="line"></span><br><span class="line">2、homebrew 安装</span><br><span class="line">brew install tesseract</span><br><span class="line">brew install --with-training-tools tesseract</span><br><span class="line"></span><br><span class="line">3、重新安装</span><br><span class="line">brew uninstall tesseract</span><br><span class="line">brew install --with-training-tools tesseract</span><br></pre></td></tr></table></figure>
<ul>
<li>Homebrew 是一个包管理器，如果没装的话，在终端执行</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ruby -e &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)&quot;</span><br></pre></td></tr></table></figure>
<p>##使用 Tesseract</p>
<ul>
<li>使用命令行进行图像识别</li>
<li>imagename 就是要识别的图片文件的名称，outputbase 就是识别结果输出文件的名称。</li>
<li>lang 就是要识别的语言代码，例如英语为 eng、简体中文为 chi_sim 等等。可以同时识别多种语言，使用 “+” 相连，例如 eng+chi_sim。缺省时识别英语。</li>
</ul>
<p>1、格式信息如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tesseract imagename outputbase [-l lang] [-psm pagesegmode] [configfile...]</span><br></pre></td></tr></table></figure></p>
<p>2、示例: 识别image图片并将结果保存在out.txt文件中<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tesseract image.png out -l chi_sim</span><br><span class="line">tesseract image.png out -l chi_sim -psm 10</span><br></pre></td></tr></table></figure></p>
<p>3、pagesegmode 为识别的具体模式，具体包含以下模式：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">•	0 = Orientation and script detection (OSD) only.</span><br><span class="line">•	1 = Automatic page segmentation with OSD.</span><br><span class="line">•	2 = Automatic page segmentation, but no OSD, or OCR</span><br><span class="line">•	3 = Fully automatic page segmentation, but no OSD. (Default)</span><br><span class="line">•	4 = Assume a single column of text of variable sizes.</span><br><span class="line">•	5 = Assume a single uniform block of vertically aligned text.</span><br><span class="line">•	6 = Assume a single uniform block of text.</span><br><span class="line">•	7 = Treat the image as a single text line.</span><br><span class="line">•	8 = Treat the image as a single word.</span><br><span class="line">•	9 = Treat the image as a single word in a circle.</span><br><span class="line">•	10 = Treat the image as a single character.</span><br><span class="line">•	11 = Sparse text. Find as much text as possible in no particular order.</span><br><span class="line">•	12 = Sparse text with OSD.</span><br><span class="line">•	13 = Raw line. Treat the image as a single text line, bypassing hacks that are Tesseract-specific.</span><br></pre></td></tr></table></figure></p>
<p>##训练样本</p>
<ul>
<li>训练工具 <a href="https://github.com/tesseract-ocr/tesseract/wiki/AddOns">https://github.com/tesseract-ocr/tesseract/wiki/AddOns</a></li>
<li>使用教程 <a href="https://github.com/tesseract-ocr/tesseract/wiki/Training-Tesseract">https://github.com/tesseract-ocr/tesseract/wiki/Training-Tesseract</a></li>
<li>提高识别率 <a href="https://github.com/tesseract-ocr/tesseract/wiki/ImproveQuality">https://github.com/tesseract-ocr/tesseract/wiki/ImproveQuality</a></li>
<li>清理文本背景 <a href="http://www.fmwconcepts.com/imagemagick/textcleaner/index.php" target="_blank" rel="noopener">http://www.fmwconcepts.com/imagemagick/textcleaner/index.php</a></li>
<li>提取文本区域 <a href="http://www.danvk.org/2015/01/07/finding-blocks-of-text-in-an-image-using-python-opencv-and-numpy.html" target="_blank" rel="noopener">http://www.danvk.org/2015/01/07/finding-blocks-of-text-in-an-image-using-python-opencv-and-numpy.html</a></li>
<li>以jTessBoxEditor为例</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; 1、收集文本信息的图片</span><br><span class="line">&gt; 2、制作的图片转为tiff格式</span><br><span class="line">&gt; 3、jTessBoxEditor进行tiff格式图片合成 &lt;Tool-&gt;Merge TIFF&gt;</span><br><span class="line"></span><br><span class="line">合成后的图片取名规范 [lang].[fontname].exp[num].tif</span><br><span class="line">[lang]是语言，[fontname]是字体，[num]是标号</span><br></pre></td></tr></table></figure>
<p>###1、Make Box Files</p>
<ul>
<li>使用 Tesseract 识别，生成 box 文件：</li>
<li>确保 tif 和 box 文件同名且位于同一目录下，用 jTessBoxEditor 打开 tif 文件），或者直接用文本编辑器编辑。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tesseract hz.font.exp0.tif hz.font.exp0 -l chi_sim -psm 10 batch.nochop makebox</span><br></pre></td></tr></table></figure>
<p>###2、Run Tesseract for Training</p>
<ul>
<li>使用修改正确后的 box 文件，对 Tesseract 进行训练，生成 .tr 文件：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tesseract hz.font.exp0.tif hz.font.exp0 -psm 10 nobatch box.train</span><br></pre></td></tr></table></figure>
<p>###3、Compute the Character Set</p>
<ul>
<li>生成字符集的文本</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">unicharset_extractor hz.font.exp0.box hz.font.exp1.box</span><br><span class="line"></span><br><span class="line">After 3.03</span><br><span class="line">training/set_unicharset_properties -U input_unicharset -O output_unicharset --script_dir=training/langdata</span><br></pre></td></tr></table></figure>
<p>正确的格式应该如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">110</span><br><span class="line">NULL 0 NULL 0</span><br><span class="line">N 5 59,68,216,255,87,236,0,27,104,227 Latin 11 0 1 N</span><br><span class="line">Y 5 59,68,216,255,91,205,0,47,91,223 Latin 33 0 2 Y</span><br><span class="line">1 8 59,69,203,255,45,128,0,66,74,173 Common 3 2 3 1</span><br><span class="line">9 8 18,66,203,255,89,156,0,39,104,173 Common 4 2 4 9</span><br><span class="line">a 3 58,65,186,198,85,164,0,26,97,185 Latin 56 0 5 a</span><br><span class="line">...</span><br></pre></td></tr></table></figure></p>
<p>###4、font_properties (new in 3.01)</p>
<ul>
<li>定义字体特征文件，Tesseract-OCR 3.01 以上的版本在训练之前需要创建一个名称为 font_properties 的字体特征文件。font_properties 不含有 BOM 头，文件内容格式如下：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;fontname&gt; &lt;italic&gt; &lt;bold&gt; &lt;fixed&gt; &lt;serif&gt; &lt;fraktur&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>其中 fontname 为字体名称，必须与 [lang].[fontname].exp[num].box 中的名称保持一致。<italic> 、<bold> 、<fixed> 、<serif>、<fraktur> 的取值为 1 或 0，表示字体是否具有这些属性。</fraktur></serif></fixed></bold></italic></li>
<li>这里就是普通字体，不倾斜不加粗，所以新建一个名为 font_properties 的文件，内容为： font 0 0 0 0 0</li>
</ul>
<p>###5、Clustering</p>
<ul>
<li>修改 Clustering 过程生成的 4 个文件（inttemp、pffmtable、normproto、shapetable）</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">shapeclustering -F font_properties -U unicharset hz.font.exp0.tr hz.font.exp1.tr ...</span><br><span class="line"></span><br><span class="line">mftraining -F font_properties -U unicharset -O hz.unicharset hz.font.exp0.tr hz.font.exp1.tr ...</span><br><span class="line"></span><br><span class="line">cntraining hz.font.exp0.tr hz.font.exp1.tr ...</span><br><span class="line">``` </span><br><span class="line"></span><br><span class="line">* 生成后的文件需要添加前缀， 如这里改为 hz.inttemp、hz.pffmtable、hz.normproto、hz.shapetable。</span><br><span class="line"></span><br><span class="line">###6、Putting it all together</span><br><span class="line"></span><br><span class="line">* 生成最后的训练文件</span><br></pre></td></tr></table></figure>
<p>combine_tessdata hz.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">###7、use example</span><br><span class="line"></span><br><span class="line">* 使用训练的文件进行识别</span><br></pre></td></tr></table></figure></p>
<p>tesseract test.png out -l hz<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">##脚本运行</span><br></pre></td></tr></table></figure></p>
<p>#!/bin/sh<br>read -p “输入你语言:” lang<br>echo ${lang}<br>read -p “输入你的字体:” font<br>echo ${font}<br>echo “完整文件名为：”<br>echo ${lang}.${font}.exp0.tif<br>echo “开始。。。”<br>echo ${font} 0 0 0 0 0 &gt;font_properties</p>
<p>#tesseract  ${lang}.${font}.exp0.tif $(lang).$(font).exp0 -l chi_sim -psm 10 batch.nochop makebox</p>
<p>#read -p “继续生产tr文件？”<br>tesseract  ${lang}.${font}.exp0.tif ${lang}.${font}.exp0 -psm 10 nobatch box.train<br>unicharset_extractor ${lang}.${font}.exp0.box<br>shapeclustering -F font_properties -U unicharset ${lang}.${font}.exp0.tr<br>mftraining -F font_properties -U unicharset -O unicharset ${lang}.${font}.exp0.tr<br>cntraining ${lang}.${font}.exp0.tr<br>echo “开始重命名文件”<br>mv inttemp ${font}.inttemp<br>mv normproto ${font}.normproto<br>mv pffmtable ${font}.pffmtable<br>mv shapetable ${font}.shapetable<br>mv unicharset ${font}.unicharset<br>echo “生成最终文件”<br>combine_tessdata ${font}.<br>echo “完成”<br><code>`</code></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Qiyun</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">18</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            

            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/Qiyun2014" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="shagengba@gmail.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Qiyun</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"qiyun"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    
    <script src="/lib/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  


















  





  

  

  

  
  

  

  
  <script type="text/javascript" src="/js/src/js.cookie.js?v=5.1.4"></script>
  <script type="text/javascript" src="/js/src/scroll-cookie.js?v=5.1.4"></script>


  

</body>
</html>
